# 🔧 構造と原理（技術補完）

本構想における処理構造は、「質問・判定・制度提示・予約・書類準備」までを一気通貫で支援する一方、
制度情報の更新・責任分担は国と自治体に分散される設計となっています。

---

## 1. 全体処理フロー（抽象モデル）

```
[ユーザー]
   ↓ 質問回答（選択式UI）
[質問モジュール（Q-Engine）]
   ↓ 条件マッチ
[制度判定ロジック]
   ↓ 結果表示（制度候補＋必要書類＋予約可）
[自治体連携API / 書類発行システム]
```

この構造により、申請前にほぼ必要な情報を揃え、来庁は最小限の「最終確認・提出」段階に限定されます。

---

## 2. 質問構文と回答処理

- 質問は「制度が前提とする条件構文」にマッピングされており、制度ごとに関連質問IDを持ちます
- 構文は改正時にも部分的差し替えが可能で、ロジック更新と質問管理が分離されています
- 個人・法人いずれにも対応可能で、冒頭分岐によって切り替えられます

---

## 3. 制度情報DBの構造と更新責任

- **国の制度**：API連携（例：マイナポータル XML/JSON）で中央側が一元管理・配信
- **地方の制度**：自治体側のJSON-LDデータとして整備。各制度に質問セット・必要書類を付与
- UI表示時には自治体側で国・地方のデータをマージし、表示制御に使用
- 制度データの更新責任は配信元が持ち、SupportFlow本体はそれを統合・照合する構造

---

## 4. マイナンバー連携と事前情報取得

本人確認や基礎情報を事前に取得することで、質問数を大幅に減らし、申請精度を高める仕組みです。

- **取得情報例（同意後）**：年齢、世帯構成、障害認定、所得情報など
- **利用技術**：電子証明書（JPKI）による署名付き認証、NFCスマホやICカードリーダーを使用
- この情報は質問構文と組み合わせて利用可能（例：子どもがいる → 子育て支援制度を提示）

---

## 備考

- スマホ・窓口端末どちらでも同じ処理構造が使えるように設計
- 構造の詳細やスキーマは `docs/QnA_Spec.md`・`docs/PolicyDB_Schema.md` を参照
