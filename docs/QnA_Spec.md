# ❓ QnA構文仕様 – SupportFlow用質問エンジン（草案）

SupportFlowの質問エンジンは、利用者が「個人」または「法人（事業者）」であるかに応じて、制度該当条件に沿った質問セットを提示し、制度選択ロジックと接続されるよう設計されています。

---

## 1. 質問構成の基本原理

質問は構文化され、以下の情報を1セットとして持ちます：

- `id`: 質問ID（例: q001）
- `text`: 表示質問文
- `type`: 選択形式（single / multi / yesno / number）
- `options`: 選択肢（任意）
- `map`: 選択肢 → 制度マッピング（複数指定可）

```json
{
  "id": "q001",
  "text": "あなたの年齢層は？",
  "type": "single",
  "options": ["18歳未満", "18〜64歳", "65歳以上"],
  "map": {
    "65歳以上": ["制度A", "制度C"]
  }
}
```

---

## 2. 制度ロジックとの接続構造

各制度は、所定の質問項目と条件ロジックで結びつけられます：

```pseudo
IF
  q001 = "65歳以上" AND
  q003 = "一人暮らし"
THEN
  提示:「高齢者生活支援給付（制度A）」
```

制度定義の例（JSON構造）：

```json
{
  "制度A": {
    "questions": ["q001", "q003", "q007"],
    "logic": [
      {"if": {"q001": "65歳以上", "q003": "一人暮らし"}, "then": "提示"}
    ],
    "required_docs": ["本人確認書類", "住民票"]
  }
}
```

---

## 3. 属性補完（マイナンバー連携）

質問によっては、マイナンバー取得情報で事前入力が可能です：

```json
{
  "id": "q004",
  "text": "扶養親族の有無",
  "type": "yesno",
  "prefill": "from_mynumber.income_data.dependents"
}
```

---

## 4. 質問構文の更新・運用上の注意

- 回答はJSONで一元収集 → 匿名ログで改善検討可能
- 質問構文・制度構文は独立管理され、個別に更新可能
- バージョン管理対応（構文v1.0 → v1.1 など）

---

## 5. 利用者種別による質問分岐

SupportFlowは初期設問で「個人／法人」を分岐させ、それぞれに別の質問構文セットを提示します。

```json
{
  "question_id": "Q0",
  "text": "あなたはどちらですか？",
  "options": [
    {"label": "個人", "next": "Q1_individual"},
    {"label": "法人・事業者", "next": "Q1_corporate"}
  ]
}
```

これにより、法人向け補助金・雇用対策等の制度も構文展開が可能となります。
